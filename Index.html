<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2D Rocket League iPad</title>
    <style>
        body { margin: 0; overflow: hidden; background: #222; font-family: sans-serif; }
        canvas { display: block; background: #355e3b; touch-action: none; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; color: white; font-size: 24px; pointer-events: none; }
    </style>
</head>
<body>

<div id="ui">Blå: <span id="blueScore">0</span> | Oransje: <span id="orangeScore">0</span></div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const blueScoreEl = document.getElementById('blueScore');
const orangeScoreEl = document.getElementById('orangeScore');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Spill-innstillinger
const friction = 0.98;
const gravity = 0.1; // Liten tiltrekning mot midten eller "bakken" kan legges til
let score = { blue: 0, orange: 0 };

// Bil-objekt
class Car {
    constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.angle = 0;
        this.speed = 0;
        this.vx = 0;
        this.vy = 0;
        this.width = 40;
        this.height = 20;
        this.accel = 0.2;
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angle);
        ctx.fillStyle = this.color;
        ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
        // Lykter for å se retning
        ctx.fillStyle = "white";
        ctx.fillRect(this.width/2 - 5, -this.height/2, 5, 5);
        ctx.fillRect(this.width/2 - 5, this.height/2 - 5, 5, 5);
        ctx.restore();
    }

    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vx *= friction;
        this.vy *= friction;

        // Vegg-kollisjon
        if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
        if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
    }
}

// Ball-objekt
const ball = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    radius: 15,
    vx: 0,
    vy: 0,
    draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.closePath();
    },
    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vx *= 0.99;
        this.vy *= 0.99;

        // Sjekk mål
        if (this.y > canvas.height/3 && this.y < (canvas.height/3)*2) {
            if (this.x < 0) resetBall('orange');
            if (this.x > canvas.width) resetBall('blue');
        } else {
            if (this.x < 0 || this.x > canvas.width) this.vx *= -1;
        }
        
        if (this.y < 0 || this.y > canvas.height) this.vy *= -1;
    }
};

const player = new Car(100, canvas.height / 2, "#3498db");

// Touch-kontroller
let touches = {};
window.addEventListener('touchstart', (e) => {
    for (let t of e.changedTouches) {
        touches[t.identifier] = { x: t.clientX, y: t.clientY };
    }
});
window.addEventListener('touchmove', (e) => {
    for (let t of e.changedTouches) {
        touches[t.identifier] = { x: t.clientX, y: t.clientY };
    }
});
window.addEventListener('touchend', (e) => {
    for (let t of e.changedTouches) delete touches[t.identifier];
});

function handleInput() {
    for (let id in touches) {
        let t = touches[id];
        // Venstre side styring
        if (t.x < canvas.width / 2) {
            if (t.y < canvas.height / 2) player.angle -= 0.05;
            else player.angle += 0.05;
        } 
        // Høyre side gass
        else {
            player.vx += Math.cos(player.angle) * player.accel;
            player.vy += Math.sin(player.angle) * player.accel;
        }
    }
}

function checkCollision(car, ball) {
    let dx = car.x - ball.x;
    let dy = car.y - ball.y;
    let distance = Math.sqrt(dx * dx + dy * dy);

    if (distance < car.width / 2 + ball.radius) {
        ball.vx = -dx * 0.2;
        ball.vy = -dy * 0.2;
    }
}

function resetBall(winner) {
    if(winner === 'blue') score.blue++;
    else score.orange++;
    
    blueScoreEl.innerText = score.blue;
    orangeScoreEl.innerText = score.orange;

    ball.x = canvas.width / 2;
    ball.y = canvas.height / 2;
    ball.vx = 0;
    ball.vy = 0;
}

function drawPitch() {
    // Midtlinje
    ctx.strokeStyle = "rgba(255,255,255,0.3)";
    ctx.lineWidth = 5;
    ctx.beginPath();
    ctx.moveTo(canvas.width/2, 0);
    ctx.lineTo(canvas.width/2, canvas.height);
    ctx.stroke();

    // Målsoner
    ctx.fillStyle = "rgba(52, 152, 219, 0.5)";
    ctx.fillRect(0, canvas.height/3, 10, canvas.height/3);
    ctx.fillStyle = "rgba(230, 126, 34, 0.5)";
    ctx.fillRect(canvas.width-10, canvas.height/3, 10, canvas.height/3);
}

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    drawPitch();
    handleInput();
    
    player.update();
    player.draw();
    
    ball.update();
    ball.draw();
    
    checkCollision(player, ball);
    
    requestAnimationFrame(loop);
}

loop();

// Håndter skjermstørrelse
window.onresize = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
};
</script>
</body>
</html>
